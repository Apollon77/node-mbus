version: 'test-{build}'
environment:
  matrix:
    - nodejs_version: '4'
    - nodejs_version: '6'
    - nodejs_version: '8'
platform:
  - x86
  - x64
clone_folder: 'c:\projects\%APPVEYOR_PROJECT_NAME%'
install:
  - ps: 'Install-Product node $env:nodejs_version $env:platform'
  - git clone https://github.com/StudioEtrange/socat-windows socat
  - git clone -b build-windows --single-branch https://github.com/Apollon77/libmbus.git libmbus
  - cp config.h libmbus/config.h
  - npm install
test_script:
  - ps: |-
      $MyProcess = Start-Process -FilePath socat/socat -ArgumentList ('pty,link=/tmp/virtualcom0,raw','tcp:127.0.0.1:15001') -PassThru;
  - node --version
  - npm --version
  - npm test
  - type crash.log & exit 0
build: 'off'
