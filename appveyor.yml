version: 'test-{build}'
environment:
  matrix:
    - nodejs_version: '4'
    - nodejs_version: '6'
    - nodejs_version: '8'
platform:
  - x86
  - x64
clone_folder: 'c:\projects\%APPVEYOR_PROJECT_NAME%'
install:
  - ps: 'Install-Product node $env:nodejs_version $env:platform'
  - git clone -b build-windows --single-branch https://github.com/Apollon77/libmbus.git libmbus
  - cp config.h libmbus/config.h
  - appveyor DownloadFile https://cygwin.com/setup-x86.exe -FileName C:\cygwin\setup-x86.exe
  - C:\cygwin\setup-x86.exe -qnNdO -R C:/cygwin -s http://cygwin.mirror.constant.com -l C:/cygwin/var/cache/setup
  - C:\cygwin\setup-x86.exe -qnNdO -R C:/cygwin -s http://cygwin.mirror.constant.com -l C:/cygwin/var/cache/setup -P socat
  - C:\cygwin\bin\socat.exe -xs pty,link=\\.\\COM1,ispeed=9600,ospeed=9600,raw tcp:127.0.0.1:15001 & exit 0
  - npm install --debug
  - type C:\projects\node-mbus\build\libmbus.vcxproj & exit 0
test_script:
  - node --version
  - npm --version
  - npm test
  - type crash.log & exit 0
build: 'off'
